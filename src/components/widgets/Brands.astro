---
import { Icon } from 'astro-icon/components';
import type { Brands as Props } from '~/types';

import Image from '~/components/common/Image.astro';
import AnimatedTitle from '~/components/ui/AnimatedTitle.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';

const {
  title = '',
  subtitle = '',
  tagline = '',
  icons = [],
  images = [],
  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
  headingLevel = 'h2',
} = Astro.props;
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-6xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <div class="mb-8 text-center md:mx-auto md:mb-12">
    {
      tagline && (
        <p
          data-animate
          data-anim-type="fade-down"
          class="font-bold uppercase tracking-normal text-slate-900/30 dark:text-slate-300/50"
          set:html={tagline}
        />
      )
    }
    {
      title && (
        <AnimatedTitle
          title={title}
          headingLevel={headingLevel}
          class="Anklepants text-heading text-center text-4xl lg:text-5xl"
        />
      )
    }
    {subtitle && <p data-animate data-anim-type="typewriter" class="mt-4 text-xl text-muted" set:html={subtitle} />}
  </div>

  <div class="lg:gap-x-15 flex flex-wrap justify-center gap-x-3 sm:gap-x-12">
    {icons && icons.map((icon) => <Icon name={icon} class="mx-auto h-auto w-12 py-3 text-gray-500 sm:mx-0 lg:py-5" />)}
    {
      images &&
        images.map((image, index) =>
          image.src ? (
            <div
              class="brand-logo-container col-span-1 my-2 flex flex-col items-center rounded-md bg-transparent px-3 py-3 lg:my-4"
              data-animate
              data-anim-type="scale-up"
              data-anim-delay={index * 50}
            >
              {image.href ? (
                <a
                  href={image.href}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="brand-link group relative block"
                  data-tooltip={image.alt || image.title}
                >
                  <Image
                    src={image.src}
                    alt={image.alt || ''}
                    class="max-full transition-transform duration-200 group-hover:scale-110"
                    width={70}
                    height={70}
                    layout="fixed"
                  />
                  <span class="brand-tooltip pointer-events-none absolute bottom-full left-1/2 mb-2 -translate-x-1/2 whitespace-nowrap rounded-md bg-slate-900 px-3 py-2 text-sm text-white opacity-0 shadow-lg transition-opacity duration-200 group-hover:opacity-100 dark:bg-slate-100 dark:text-slate-900">
                    {image.alt || image.title}
                    <span class="absolute left-1/2 top-full -translate-x-1/2 border-4 border-transparent border-t-slate-900 dark:border-t-slate-100"></span>
                  </span>
                </a>
              ) : (
                <div class="relative" data-tooltip={image.alt || image.title}>
                  <Image
                    src={image.src}
                    alt={image.alt || ''}
                    class="max-full"
                    width={70}
                    height={70}
                    layout="fixed"
                  />
                </div>
              )}
              {image.title && <span class="mt-2 text-xs tracking-wider text-muted dark:text-white">{image.title}</span>}
            </div>
          ) : null
        )
    }
  </div>

  <script>
    // Mobile long-press handling
    document.addEventListener('DOMContentLoaded', () => {
      const brandLinks = document.querySelectorAll('.brand-link');

      brandLinks.forEach((link) => {
        let pressTimer: ReturnType<typeof setTimeout>;
        let longPressTriggered = false;
        const tooltip = link.querySelector('.brand-tooltip');

        const startPress = (e: Event) => {
          longPressTriggered = false;
          pressTimer = setTimeout(() => {
            longPressTriggered = true;
            if (tooltip) {
              tooltip.classList.add('opacity-100', '!pointer-events-auto');
              tooltip.classList.remove('opacity-0');
            }
          }, 500); // 500ms for long press
        };

        const endPress = (e: Event) => {
          clearTimeout(pressTimer);
          if (longPressTriggered) {
            e.preventDefault();
            setTimeout(() => {
              if (tooltip) {
                tooltip.classList.remove('opacity-100', '!pointer-events-auto');
                tooltip.classList.add('opacity-0');
              }
            }, 2000); // Hide after 2 seconds
          }
        };

        const cancelPress = () => {
          clearTimeout(pressTimer);
          if (tooltip) {
            tooltip.classList.remove('opacity-100', '!pointer-events-auto');
            tooltip.classList.add('opacity-0');
          }
        };

        // Touch events for mobile
        link.addEventListener('touchstart', startPress, { passive: false });
        link.addEventListener('touchend', endPress, { passive: false });
        link.addEventListener('touchmove', cancelPress, { passive: true });
        link.addEventListener('touchcancel', cancelPress, { passive: true });
      });
    });
  </script>
</WidgetWrapper>
